<!DOCTYPE html>
<html>

<head>
    <title>P2P</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="icon" href="files/favicon.ico" type="image/png">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <div id="toast" class="toast-notification">ID copied to clipboard</div>
        <script src="js/other/toastNotification.js"></script>
        <div style="margin-left: 10px;">
            <h1 style="margin-bottom: 0;">Chat 2.1</h1>
            <p style="color: #333; margin-top: 0;">Name pending btw lol</p>
        </div>

        <div class="setup-container" id="setupPanel">
            <h3>User Setup</h3>
            <input type="text" id="usernameInput" placeholder="Enter a display name">
            <input type="password" id="passwordInput" placeholder="Set a password (optional)">
            <button onclick="setUsername()">Save Profile</button>
            <a href="#" onclick="showHelp(); return false;">Help</a>
            <iframe id="helpFrame" style="display: none; width: 100%; height: 200px; border: 1px solid #ddd;"
                src="hewlPwease.txt"></iframe>
        </div>
        <script src="js/other/showHelp.js"></script>

        <div id="mainPanel" style="display: none;">
            <div>
                <h3>Your ID: <span id="myId">Generating...</span>
                    <button onclick="copyIdToClipboard()" class="copy-button">Copy</button>
                    <style>
                        @media (max-width: 600px) {
                            .copy-button {
                                position: relative;
                                left: 50%;
                                transform: translateX(-50%);
                            }
                        }
                    </style>
                </h3>
                <h3>Your Username: <span id="displayUsername"></span></h3>
                <div id="status" class="connection-status disconnected">Not connected</div>
            </div>
            <script src="js/other/copyToClipboard.js"></script>

            <div class="contact-list">
                <h3>Saved Contacts</h3>
                <div id="savedContacts"></div>
            </div>

            <div>
                <h3>Connect to a peer:</h3>
                <input type="text" id="peerIdInput" placeholder="Enter peer ID">
                <button onclick="connectToPeer()">Connect</button>
            </div>

            <div id="messageArea"></div>

            <div class="message-input-container">
                <input type="text" id="messageInput" placeholder="Type your message">
                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="sendMessage()">
                <button onclick="openFileManager()">üìÅ</button>
                <button onclick="sendMessage()">Send</button>
            </div>

            <div>
                <h4>Debug Log:</h4>
                <div id="debugArea"></div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let myId;
        let peer = null;
        let conn = null;
        let retryCount = 0;
        const MAX_RETRIES = 3;
        let username = '';
        let password = '';
        let encryptionKey = '';
    </script>

    <!-- Links to all js files in order -->
    <script>
        const jsFiles = ['userInteractions.js', 'userSetUp.js', 'connections.js', 'displayPeerMessage.js', 'messageSending.js', 'encryption.js', 'contacts.js', 'logs.js', 'errorHandling.js'];
        jsFiles.forEach(file => {
            const script = document.createElement('script');
            script.src = `js/${file}`;
            document.head.appendChild(script);
        });
    </script>
</body>

</html>
